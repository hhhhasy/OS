# `Lab2` 物理内存和页表

## 胡博浩 阿斯雅 赵一凡

## 练习1：理解first-fit 连续物理内存分配算法（思考题）

**要求：**

`first-fit` 连续物理内存分配算法作为物理内存分配一个很基础的方法，需要同学们理解它的实现过程。请大家仔细阅读实验手册的教程并结合`kern/mm/default_pmm.c`中的相关代码，认真分析`default_init`，`default_init_memmap`，`default_alloc_pages`， `default_free_pages`等相关函数，并描述程序在进行物理内存分配的过程以及各个函数的作用。 

**解答：**

首先`first-fit`算法的主要思想就是，当分配物理内存时总是分配第一个满足条件的那个内存块，不管它是不是最佳的，只要它比要求的内存块大小大即可。接下来，将介绍`kern/mm/default_pmm.c`中的一些核心代码的作用。

**`default_init`**：该函数用来初始化一个空的链表`free_list`，而这个链表里面存的就是那些没被分配出去的内存页框。因为是刚开始初始化，所以表示空闲内存页框的`nr_free`也被设置为0。

**`default_init_memmap`**：该函数用来把一个有n个页大小的空闲内存块放进`free_list`链表里面。具体来说的话，该函数首先通过一个for循环，把内存快里面中的全部页框的标志和属性信息清空掉，并将页框的引用计数设置为0。之后在原有的`nr_free`上加新加来的n个内存页框。随后，首先判断`free_list`链表是否为空，如果为空的话，直接在链表里面加入新来的内存块即可。但如果不是为空，程序会把内存快开始地址跟链表里面元素的地址一个个比较，如果找到了一个比新来的内存块开始地址大的元素，就把新来的内存块插入到它前面，如果没有找到，就把新来的内存块插入到链表的队尾。

**`default_alloc_pages`**：